## 【redis】redis实际运用中的缓存问题



## 缓存处理流程

 前台请求，后台先从缓存中取数据，取到直接返回结果，取不到时从数据库中取，数据库取到更新缓存，并返回结果，数据库也没取到，那直接返回空结果。



## 问题及解决

### 缓存穿透

缓存中没有，数据库中也没有。而用户不断发起请求。这时的用户很可能是攻击者，攻击会导致数据库压力过大。

**解决：**

1. 接口层增加校验，如用户鉴权校验，id做基础校验，id<=0的直接拦截；
2. 从缓存取不到的数据，在数据库中也没有取到，这时也可以将key-value对写为key-null，缓存有效时间可以设置短点，如30秒（设置太长会导致正常情况也没法使用）。这样可以防止攻击用户反复用同一个id暴力攻击



### 缓存击穿

缓存中没有，数据库中有（一般是缓存时间到期），一段时间大量用户并发查找。同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力。

**解决：**

1. 设置热点数据永远不过期。
2. 加互斥锁



### 缓存雪崩

缓存雪崩是指缓存中数据大批量到过期时间，而查询数据量巨大，引起数据库压力过大甚至down机。和缓存击穿不同的是，缓存击穿指并发查同一条数据，缓存雪崩是不同数据都过期了，很多数据都查不到从而查数据库。

**解决：**

1. 缓存数据的过期时间设置随机，防止同一时间大量数据过期现象发生
2. 如果缓存数据库是分布式部署，将热点数据均匀分布在不同搞得缓存数据库中。
3. 设置热点数据永远不过期。



![redis缓存问题](https://i.loli.net/2021/03/19/wDze2FqpdGmySsk.png)

---

参考：

- [缓存穿透、缓存击穿、缓存雪崩区别和解决方案_kongtiao5的专栏-CSDN博客_缓存击穿](https://blog.csdn.net/kongtiao5/article/details/82771694)
- [如何解决Redis雪崩、穿透、并发等5大难题 - 知乎](https://zhuanlan.zhihu.com/p/58331707)
- [Redis系列(一)底层数据结构之简单动态字符串 - 呼延十的博客 | HuYan Blog](http://huyan.couplecoders.tech/redis/2020/01/05/Redis%E7%B3%BB%E5%88%97(%E4%B8%80)%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2/)
- [Redis系列(二)底层数据结构之双端链表 - 呼延十的博客 | HuYan Blog](http://huyan.couplecoders.tech/redis/2020/01/06/Redis%E7%B3%BB%E5%88%97(%E4%BA%8C)%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E5%8F%8C%E7%AB%AF%E9%93%BE%E8%A1%A8/)
- [《今天面试了吗》-Redis](https://juejin.cn/post/6844904017387077640)
- [深入学习Redis（2）：持久化 - 编程迷思 - 博客园](https://www.cnblogs.com/kismetv/p/9137897.html)